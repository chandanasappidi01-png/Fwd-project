<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusBoard | Ultimate Task Manager</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries for "Super" Features -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.4);
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --card-bg: rgba(51, 65, 85, 0.6);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --sidebar-width: 260px;
        }

        [data-theme="light"] {
            --bg-gradient: linear-gradient(135deg, #f0f2f5 0%, #e2e8f0 100%);
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(0, 0, 0, 0.05);
            --text-main: #1e293b;
            --text-muted: #64748b;
            --card-bg: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background: var(--bg-gradient);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            transition: 0.3s;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--glass-border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
        }

        .nav-menu { list-style: none; margin-top: 20px; }
        .nav-item {
            padding: 12px 15px;
            border-radius: 12px;
            cursor: pointer;
            color: var(--text-muted);
            font-weight: 500;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nav-item.active, .nav-item:hover {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px var(--primary-glow);
        }

        .theme-toggle {
            margin-top: auto;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border: 1px solid var(--glass-border);
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        header {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-box {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 300px;
            color: var(--text-main);
        }
        .search-box input {
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-main);
            width: 100%;
        }

        .header-actions { display: flex; align-items: center; gap: 20px; }

        .btn-new {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--primary-glow);
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-new:hover { transform: translateY(-2px); }

        /* --- KANBAN BOARD --- */
        .board {
            flex: 1;
            overflow-x: auto;
            padding: 20px 30px;
            display: flex;
            gap: 25px;
            align-items: flex-start;
        }

        .column {
            min-width: 320px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            max-height: 85vh;
            backdrop-filter: blur(10px);
            transition: box-shadow 0.3s;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 5px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .badge-count {
            background: var(--card-bg);
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
        }

        /* --- CARDS --- */
        .task-list {
            flex: 1;
            overflow-y: auto;
            min-height: 100px;
            padding: 5px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            cursor: grab;
            position: relative;
            transition: all 0.2s;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .card-tags { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
        .tag {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }
        .tag-design { background: rgba(99, 102, 241, 0.2); color: #818cf8; }
        .tag-dev { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .tag-urgent { background: rgba(239, 68, 68, 0.2); color: #f87171; }

        .card h4 { font-size: 1rem; margin-bottom: 8px; color: var(--text-main); }
        .card p { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px; line-height: 1.4; }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--glass-border);
            padding-top: 12px;
        }

        .avatars { display: flex; }
        .avatars img {
            width: 28px; height: 28px; border-radius: 50%;
            border: 2px solid var(--card-bg);
            margin-left: -8px;
        }
        .avatars img:first-child { margin-left: 0; }

        .card-meta { font-size: 0.8rem; color: var(--text-muted); display: flex; gap: 10px; }
        .meta-item { display: flex; align-items: center; gap: 4px; }
        .overdue { color: var(--danger); font-weight: bold; }

        /* Sortable JS styles */
        .sortable-ghost { opacity: 0.4; background: var(--primary); border: 2px dashed white; }
        .sortable-drag { cursor: grabbing; opacity: 1; transform: scale(1.05); }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 100; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.open { display: flex; opacity: 1; align-items: center; justify-content: center; }

        .modal {
            background: #1e293b; color: white;
            width: 450px; padding: 30px; border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--glass-border);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-overlay.open .modal { transform: scale(1); }
        [data-theme="light"] .modal { background: #ffffff; color: #1e293b; }

        .modal input, .modal select, .modal textarea {
            width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border);
            padding: 12px; border-radius: 8px; color: inherit; margin-bottom: 15px; outline: none;
        }
        .modal label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .modal h2 { margin-bottom: 20px; color: var(--primary); }

        .btn-submit { width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* --- TOAST --- */
        .toast {
            position: fixed; bottom: 30px; right: 30px;
            background: var(--glass-bg); backdrop-filter: blur(10px);
            border-left: 5px solid var(--success);
            padding: 15px 25px; border-radius: 8px;
            color: var(--text-main); font-weight: 500;
            box-shadow: 0 10px 15px rgba(0,0,0,0.2);
            transform: translateX(150%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .toast.show { transform: translateX(0); }

        /* Delete Button on Card (Hidden by default) */
        .delete-btn {
            position: absolute; top: 10px; right: 10px;
            color: var(--text-muted); cursor: pointer; opacity: 0; transition: 0.2s;
        }
        .card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { color: var(--danger); }

    </style>
</head>
<body data-theme="dark">

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo"><i class="fas fa-layer-group"></i> NexusBoard</div>
        <ul class="nav-menu">
            <li class="nav-item active"><i class="fas fa-columns"></i> Kanban Board</li>
            <li class="nav-item"><i class="fas fa-chart-pie"></i> Analytics</li>
            <li class="nav-item"><i class="fas fa-users"></i> Team</li>
            <li class="nav-item"><i class="fas fa-cog"></i> Settings</li>
        </ul>

        <div class="theme-toggle" onclick="toggleTheme()">
            <span><i class="fas fa-moon"></i> Dark Mode</span>
            <i class="fas fa-toggle-on" id="theme-icon" style="color:var(--primary)"></i>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header>
            <div class="search-box">
                <i class="fas fa-search" style="color:var(--text-muted)"></i>
                <input type="text" placeholder="Search tasks..." id="searchInput" onkeyup="filterTasks()">
            </div>
            <div class="header-actions">
                <div class="avatars" style="margin-right:15px">
                    <img src="https://i.pravatar.cc/150?u=a" title="You">
                    <img src="https://i.pravatar.cc/150?u=b" title="Alice">
                    <img src="https://i.pravatar.cc/150?u=c" title="Bob">
                    <div style="width:28px; height:28px; border-radius:50%; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-size:0.7rem; border:2px solid var(--card-bg); margin-left:-8px;">+4</div>
                </div>
                <button class="btn-new" onclick="openModal()"><i class="fas fa-plus"></i> New Task</button>
            </div>
        </header>

        <div class="board">
            <!-- Columns -->
            <div class="column">
                <div class="column-header">
                    <span><i class="far fa-circle" style="color: #cbd5e1;"></i> To Do</span>
                    <span class="badge-count" id="count-todo">0</span>
                </div>
                <div id="todo" class="task-list"></div>
            </div>

            <div class="column">
                <div class="column-header">
                    <span><i class="fas fa-spinner fa-spin" style="color: var(--primary);"></i> In Progress</span>
                    <span class="badge-count" id="count-inprogress">0</span>
                </div>
                <div id="inprogress" class="task-list"></div>
            </div>

            <div class="column">
                <div class="column-header">
                    <span><i class="far fa-check-circle" style="color: var(--success);"></i> Review</span>
                    <span class="badge-count" id="count-review">0</span>
                </div>
                <div id="review" class="task-list"></div>
            </div>

            <div class="column">
                <div class="column-header">
                    <span><i class="fas fa-check-double" style="color: var(--success);"></i> Done</span>
                    <span class="badge-count" id="count-done">0</span>
                </div>
                <div id="done" class="task-list"></div>
            </div>
        </div>
    </main>

    <!-- Modal -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <h2><i class="fas fa-sparkles"></i> Create New Task</h2>
            <form id="taskForm" onsubmit="createTask(event)">
                <label>Title</label>
                <input type="text" id="tTitle" required placeholder="Make it sound epic...">
                
                <label>Description</label>
                <textarea id="tDesc" rows="3" placeholder="Details about the mission..."></textarea>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div>
                        <label>Tag</label>
                        <select id="tTag">
                            <option value="tag-design">Design</option>
                            <option value="tag-dev">Development</option>
                            <option value="tag-urgent">Urgent</option>
                        </select>
                    </div>
                    <div>
                        <label>Due Date</label>
                        <input type="date" id="tDate" required>
                    </div>
                </div>

                <button type="submit" class="btn-submit">Launch Task ðŸš€</button>
                <button type="button" onclick="closeModal()" style="width:100%; background:transparent; border:none; color:var(--text-muted); margin-top:10px; cursor:pointer;">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Task Updated Successfully!</div>

    <script>
        // --- STATE MANAGEMENT ---
        let tasks = JSON.parse(localStorage.getItem('nexusTasks')) || [
            { id: '1', title: 'Redesign Landing Page', desc: 'Use glassmorphism aesthetics.', tag: 'tag-design', date: '2023-12-25', status: 'todo' },
            { id: '2', title: 'API Integration', desc: 'Connect to the Node.js backend.', tag: 'tag-dev', date: '2024-01-10', status: 'inprogress' },
            { id: '3', title: 'Fix Login Bug', desc: 'Auth token expiring too soon.', tag: 'tag-urgent', date: '2023-11-01', status: 'done' }
        ];

        // --- INIT SORTABLE JS ---
        // We initialize Sortable on all 4 columns
        ['todo', 'inprogress', 'review', 'done'].forEach(colId => {
            new Sortable(document.getElementById(colId), {
                group: 'nexusBoard', // allow dragging between lists
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                delay: 100, // slight delay prevents accidental drags on touch
                delayOnTouchOnly: true,
                onEnd: function (evt) {
                    const itemEl = evt.item;
                    const newStatus = evt.to.id;
                    const oldStatus = evt.from.id;
                    
                    // Update Data
                    const taskId = itemEl.getAttribute('data-id');
                    const task = tasks.find(t => t.id === taskId);
                    task.status = newStatus;
                    
                    saveTasks();
                    updateCounts();

                    // IF DROPPED IN DONE -> CELEBRATE
                    if (newStatus === 'done' && oldStatus !== 'done') {
                        triggerConfetti();
                        showToast("Task Completed! ðŸŽ‰");
                    }
                }
            });
        });

        // --- RENDER LOGIC ---
        function renderTasks() {
            // Clear lists
            ['todo', 'inprogress', 'review', 'done'].forEach(id => document.getElementById(id).innerHTML = '');
            
            tasks.forEach(task => {
                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('data-id', task.id);
                
                // Determine Tag Name
                let tagName = 'General';
                if(task.tag === 'tag-design') tagName = 'Design';
                if(task.tag === 'tag-dev') tagName = 'Dev';
                if(task.tag === 'tag-urgent') tagName = 'Urgent';

                // Date Logic
                const isOverdue = new Date(task.date) < new Date() && task.status !== 'done';
                const dateClass = isOverdue ? 'overdue' : '';
                const dateIcon = isOverdue ? '<i class="fas fa-exclamation-circle"></i>' : '<i class="far fa-clock"></i>';

                card.innerHTML = `
                    <i class="fas fa-trash delete-btn" onclick="deleteTask('${task.id}')"></i>
                    <div class="card-tags">
                        <span class="tag ${task.tag}">${tagName}</span>
                    </div>
                    <h4>${task.title}</h4>
                    <p>${task.desc}</p>
                    <div class="card-footer">
                        <div class="avatars">
                            <img src="https://i.pravatar.cc/150?u=${task.id}" alt="user">
                        </div>
                        <div class="card-meta">
                            <div class="meta-item ${dateClass}">${dateIcon} ${task.date}</div>
                            <div class="meta-item"><i class="far fa-comment"></i> 2</div>
                        </div>
                    </div>
                `;
                
                // Append to correct column
                if(document.getElementById(task.status)) {
                    document.getElementById(task.status).appendChild(card);
                }
            });
            updateCounts();
        }

        function updateCounts() {
            ['todo', 'inprogress', 'review', 'done'].forEach(status => {
                const count = tasks.filter(t => t.status === status).length;
                document.getElementById(`count-${status}`).innerText = count;
            });
        }

        // --- ACTIONS ---
        function createTask(e) {
            e.preventDefault();
            const title = document.getElementById('tTitle').value;
            const desc = document.getElementById('tDesc').value;
            const tag = document.getElementById('tTag').value;
            const date = document.getElementById('tDate').value;

            const newTask = {
                id: Date.now().toString(),
                title, desc, tag, date,
                status: 'todo'
            };

            tasks.push(newTask);
            saveTasks();
            renderTasks();
            closeModal();
            showToast("New Task Created ðŸš€");
            e.target.reset();
        }

        function deleteTask(id) {
            if(confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                renderTasks();
                showToast("Task Deleted");
            }
        }

        function filterTasks() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.card');
            
            cards.forEach(card => {
                const title = card.querySelector('h4').innerText.toLowerCase();
                const desc = card.querySelector('p').innerText.toLowerCase();
                if(title.includes(query) || desc.includes(query)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // --- UTILS ---
        function saveTasks() {
            localStorage.setItem('nexusTasks', JSON.stringify(tasks));
        }

        function openModal() {
            document.getElementById('taskModal').classList.add('open');
        }

        function closeModal() {
            document.getElementById('taskModal').classList.remove('open');
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (body.getAttribute('data-theme') === 'dark') {
                body.setAttribute('data-theme', 'light');
                icon.className = 'fas fa-toggle-off';
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-toggle-on';
            }
        }

        // --- VISUAL FX ---
        function triggerConfetti() {
            var count = 200;
            var defaults = {
                origin: { y: 0.7 }
            };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }

        // Initialize
        renderTasks();

    </script>
</body>
</html>